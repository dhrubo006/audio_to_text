<!DOCTYPE html>
<html>
<head>
    <!-- Title of the web page -->
    <title>Audio Transcription and Response Generator</title>
</head>

<body>
    <!-- Heading for the audio upload section -->
    <h3>Upload Audio for Transcription</h3>

    <!-- Form for uploading audio files -->
    <form id="uploadForm" action="/uploader" method="POST" enctype="multipart/form-data">
        <!-- Input for selecting an audio file, accepting only audio file types -->
        <input type="file" name="file" accept="audio/*" />
        <!-- Submit button for the form -->
        <input type="submit" value="Upload Audio File" />
    </form>

    <!-- Div elements for displaying the transcription and generated response -->
    <div id="transcription"></div>
    <div id="response"></div>

    <script>
        // JavaScript code to handle the form submission
        document.getElementById('uploadForm').onsubmit = function (event) {
            // Prevent the default form submission behavior
            event.preventDefault();

            // Create FormData object from the form
            var formData = new FormData(this);

            // Make an asynchronous POST request to the server with the form data
            fetch('/uploader', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())  // Parsing the JSON response from the server
            .then(data => {
                // Displaying the transcription and response in their respective divs
                document.getElementById('transcription').innerText = 'Transcription: ' + data.transcription;
                document.getElementById('response').innerText = 'Response: ' + data.response;

                // Using the speech synthesis API to speak out the transcription and response
                speak(data.transcription);
                speak(data.response);
            })
            .catch(error => console.error('Error:', error)); // Handling any errors in the fetch operation
        };

        // Function to use the Web Speech API's speech synthesis feature
        function speak(text) {
            var utterance = new SpeechSynthesisUtterance(text);
            speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>
